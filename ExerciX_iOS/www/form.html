<!DOCTYPE HTML>
<html>
<head>
<title>ExerciX</title>
    <meta charset="utf-8">
<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" charset="utf-8" src="litegap.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/handlebars.js"></script>
    <link rel="stylesheet" href="css/index.css" type="text/css">
        <link rel="stylesheet" href="css/font-awesome.css" type="text/css">
            
            <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
            
            
            
<script type="text/javascript" charset="utf-8">

 var cleanURL = function(str){
    str = str.replace(/^\s+|\s+$/g, '');
    str = str.toLowerCase();
    var from = "ãàáäâẽèéëêìíïîõòóöôùúüûñç·/_,:;";
    var to   = "aaaaaeeeeeiiiiooooouuuunc------";
 for (var i=0, l=from.length ; i<l ; i++){
    str = str.replace(new RegExp(from.charAt(i), 'g'), to.charAt(i)); } 
    str = str.replace(/[^a-z0-9 -]/g, '').replace(/\s+/g, '-').replace(/-+/g, '-');
    return str; };

function refreshDB(){

if (window.litegap) {
    window.litegap.getURL(function(err, url) {
        if (err) {
            console.log("error launching: " + err)
            alert("Aie ! Problème avec la DB ! Envoyez un mail à contact@exercix.net");
        } else {
            console.log("Couchbase Lite running at " + url);
         //   alert("Couchbase Lite running at " + url);
         //   alert('0');
            function delDB(){
                $.ajax({
                    type:"DELETE",
                    url:url+"/exercix", 
                    contentType: "application/json",
                    success:function(){
                        console.log("+1");
                        createDB();
                    },
                    error:function(data){
                        if(data.status == 404){
                            console.log("404, +1");
                            createDB();
                        }
                        else{
                        console.log('-1');
                        console.log(JSON.stringify(data));
                        delDB();
                        }
                    }
                });
            }
            function createDB(){
                $.ajax({
                    type:"PUT",
                    url:url+"/exercix", 
                    contentType: "application/json",
                    success:function(){
                        console.log("+2");
                        saveDesign();
                    },
                    error:function(data){
                        console.log('-2');
                        console.log(JSON.stringify(data));
                        delDB();
                    }
                });
            }

            function saveDesign(){
                $.ajax({
                    type:"PUT",
                    url:url+"/exercix/_design/design-doc", 
                    contentType: "application/json",
                    dataType: "json",
                    data : '{"views" : {"list-view" : {"map" : "function(doc){ if(doc.chapter){emit(doc.chapter, doc)}}"}}}',
                    success:function(){
                        console.log("+3");
                        getJSONRemoteFile();
                    },
                    error:function(data){
                        if(data.status==409){
                            getJSONRemoteFile()
                        }
                        else{
                            if(data.status==400){
                                console.log('-3');
                                console.log(JSON.stringify(data));
                                saveDesign();
                            }
                            else{
                            console.log('-3');
                            console.log(JSON.stringify(data));
                            delDB();
                            }
                        }
                    }
                });
            }


            function getJSONRemoteFile(){
            $.ajax({
                dataType: "json",
                url: "http://exercix.net/data.json",
                success : function(data){
                console.log("+4")
                saveDocs(data);
                },
                error : function(data) {
                    console.log('-4');
                    console.log(JSON.stringify(data));
                    getJSONLocalFile();
                }
            });
            }

            function getJSONLocalFile(){
            $.ajax({
                dataType: "json",
                url: "data2.json",
                success : function(data){
                console.log("+4")
                saveDocs(data);
                },
                error : function(data) {
                    console.log('-4');
                    console.log(JSON.stringify(data));
                    delDB();
                }
            });
            }

            function saveDocs(data){
                    $.ajax({
                    type:"POST",
                    url:url+"/exercix/_bulk_docs", 
                    contentType: "application/json",
                    dataType: "json",
                    data : '{"docs" : ' + JSON.stringify(data) + '}',
                    success:function(){
                        console.log("+5");
                        window.location = "index.html";
                    },
                    error:function(data){
                        if(data.status==400){
                            console.log('-5');
                            console.log(JSON.stringify(data));
                            getJSONRemoteFile();
                        }
                        else{
                            console.log('-5');
                            console.log(JSON.stringify(data));
                            delDB();
                        }
                    }
                });
            }
            delDB();

             
        }
    });
        } else {
            console.log("LiteGap plugin not installed.");
            alert("LiteGap plugin not installed.");
        }
    }

</script>


</head>
    <body id="launch-page">





    <form id="launch-form">
        <p>
       Attention: ceci est une version de lancement: la base d’exercices est très limitée. Vous pouvez ainsi tester l’application, et juger si la version complète peut vous intéresser.
<br><br>
Nous travaillons actuellement sur cette version complète (beaucoup plus d’exercices), mais nous ne la terminerons que si cette version de lancement démontre une demande suffisante. Montrez nous donc votre intérêt en partageant cette application avec vos camarades (sur smartphone et tablettes!), et en inondant de “likes” notre page facebook !
<br>
<span id="launch-fb">facebook.com/Exercix</span>
<br><br><br>
        Merci de remplir ces quelques infos qui nous aideront à améliorer l'appli ! <br><br>
    </p>
        <input type="email" id='input-mail' required placeholder="Email"><br>
        <input type="tel" id='input-zipcode' required placeholder="Code postal de la prépa"><br>
             <div id="select"><i class="icon-chevron-down"></i><select disabled id='select-nomprepa' required>
                <option> Nom de la Prépa </option>
             </select></div>
            <input id="fil1" type="radio" name="filiere" required value="MP" ><label for="fil1">MP/MP*</label>
            <input id="fil2" type="radio" name="filiere" required value="PC" ><label for="fil2">PC/PC*</label>
            <input id="fil3" type="radio" name="filiere" required value="PSI"><label for="fil3">PSI/PSI*</label>
            <input id="fil4" type="radio" name="filiere" required value="PT"><label for="fil4">PT/PT*</label>
        
            <br>
            <br>
         <input type="submit" value="Envoyer">
    </form>


<br>
            <div class="single-nav">
                <a href='index.html'>Revenir au menu</a>
            </div>

        <script>
                $('input[type="radio"]').next('label').click(function(){
                                               $(this).prev('input').attr('checked',true);});


            var prepas = {"1":["Lycée Lalande"], "2":["Lycée Pierre de la Ramée"], "3":["Lycée Paul Constans"], "6":["Centre international de Valbonne","Lycée privé Stanislas","Lycée Masséna","Lycée Les Eucalyptus"],"01":["Lycée Lalande"], "02":["Lycée Pierre de la Ramée"], "03":["Lycée Paul Constans"], "06":["Centre international de Valbonne","Lycée privé Stanislas","Lycée Masséna","Lycée Les Eucalyptus"], "10":["Lycée Chrestien De Troyes"], "13":["Lycée privé Notre-Dame de Sion","Lycée Thiers","Lycée Jean-Perrin","Lycée militaire d'Aix-en-Provence","Lycée Paul Cezanne","Lycée Vauvenargues", "Lycée l'Empéri"], "14":["Lycée Malherbe","Lycée privé Sainte-Marie","Lycée Victor-Hugo","Lycée Jules Dumont D'urville"], "16":["Lycée Guez De Balzac"], "17":["Lycée Jean Dautet"], "18":["Lycée Alain Fournier"], "19":["Lycée Edmond-Perrier"], "20":["Lycée Laetitia Bonaparte"], "21":["Lycée Carnot","Lycée Gustave-Eiffel"], "22":["Lycée Rabelais"], "24":["Lycée Bertran-de-Born"], "25":["Lycée Victor-Hugo","Lycée Jules-Haag"], "27":["Lycée Aristide Briand"], "28":["Lycée Marceau"], "29":["Lycée Brizeux","Lycée privé Sainte-Anne","Lycée naval","Lycée Kerichen","Lycée Vauban","Lycée privé la Croix-Rouge"], "30":["Lycée Alphonse-Daudet","Lycée privé Emmanuel d'Alzon","Lycée Dhuoda"], "31":["Lycée privé Saliège","Lycée Bellevue","Lycée Pierre-de-Fermat","Lycée Déodat de Séverac","Lycée privé Saint-Joseph"], "33":["Lycée Camille-Jullian","Lycée Michel-Montaigne","Lycée Gustave-Eiffel"], "34":["Lycée privé Notre-Dame de la Merci","Lycée Joffre","Lycée Jean-Mermoz"], "35":["Lycée Chateaubriand","Lycée privé Assomption","Lycée Joliot Curie"], "37":["Lycée Descartes","Lycée Jacques de Vaucanson"], "38":["Lycée Champollion","Lycée Vaucanson","École des Pupilles de l'Air","Lycée Ferdinand Buisson","Lycée privé ITEC Boisfleury"], "41":["Lycée François-Philibert Dessaignes"], "42":["Lycée Claude-Fauriel","Lycée Etienne Mimard"], "44":["Lycée privé Saint-Stanislas","Lycée Georges-Clemenceau","Lycée Eugène Livet","Lycée privé Saint-Joseph La Joliverie", "Lycée Aristide-Briand"], "45":["Lycée privé Saint-Charles","Lycée Pothier","Lycée Benjamin Franklin"], "49":["Lycée Henri Bergson","Lycée privé Saint-Martin","Lycée privé Mongazon","Lycée Chevrollier", "Lycée privé Saint-Julien-La-Baronnerie"], "50":["Lycée Victor-Grignard"], "51":["Lycée Georges-Clemenceau","Lycée Franklin-Roosevelt", "Lycée Oehmichen"], "54":["Lycée Henri-Poincaré","Lycée Henri-Loritz", "Lycée privé La Malgrange"], "56":["Lycée Alain-René-Lesage","Lycée Dupuy-de-Lôme"], "57":["Lycée Fabert","Lycée Louis de Cormontaigne", "Collège privé Saint-Augustin", "Lycée Jean Moulin"], "58":["Lycée Jules Renard"], "59":["Lycée Gambetta", "Lycée privé Saint-Rémi", "Lycée Jean Bart","Lycée de l'Europe", "Lycée Gustave Eiffel", "Lycée Henri Wallon","Lycée Albert-Châtelet", "Lycée privé Notre-Dame De Grâce", "Lycée privé Saint-Pierre","Lycée Faidherbe","Lycée César-Baggio","Lycée privé Frédéric Ozanam"], "60":["Lycée Marie-Curie","Lycée Pierre d'Ailly"], "62":["Lycée Mariette","Lycée Robespierre","Lycée Condorcet","Lycée La Fayette","Lycée privé Godefroy-de-Bouillon","Lycée Blaise-Pascal","Lycée Jean Zay"], "64":["Lycée Louis-Barthou","Lycée René Cassin"], "65":["Lycée Théophile Gautier","Lycée Jean-Dupuy"], "66":["Lycée François-Arago"], "67":["Lycée Kléber","Lycée Louis-Couffignal","Lycée privé ORT","Lycée privé Saint-Étienne"], "68":["Lycée Albert Schweitzer"], "69":["Lycée Jean-Perrin","Lycée privé Aux Lazaristes","Institution privée des Chartreux","Lycée La Martinière Monplaisir","Lycée du Parc"], "71":["Lycée La Prat's","Lycée Nicephore Niepce"], "72":["Lycée Montesquieu","Lycée Gabriel Touchard","Prytanée national militaire"], "73":["Lycée Vaugelas"], "74":["Lycée Berthollet"], "75":["École nationale de chimie physique et biologie","Lycée Buffon","Collège-lycée Jacques-Decour","Lycée Claude Bernard","Lycée Paul-Valéry","Lycée Condorcet","Lycée privé Fénelon Sainte-Marie","Lycée Fénelon","Lycée Henri-IV","Lycée Chaptal","Collège privé Stanislas","Lycée Charlemagne","Lycée Janson-de-Sailly","Lycée Saint-Louis","Lycée Louis-le-Grand","Lycée Carnot","Lycée Honoré-de-Balzac","Lycée Lavoisier","Lycée Turgot","Lycée Jean-Baptiste-Say","Lycée Raspail","Lycée Dorian"], "76":["Lycée François-Ier","Lycée Robert Schuman", "Lycée Corneille","Lycée Blaise-Pascal"], "77":["Lycée Henri Moissan","Lycée Pierre de Coubertin","Lycée Jacques Amyot","Lycée François Ier", "Lycée La Fayette","Lycée Langevin-Wallon"], "78":["Lycée Descartes (associé à Université Versailles Saint-Quentin)","Lycée militaire de Saint-Cyr","Lycée Saint-Exupéry","Lycée Jeanne d'Albret","Lycée Hoche","Lycée privé Sainte-Geneviève","Lycée Jules-Ferry"], "79":["Lycée privé Saint-Joseph"], "80":["Lycée Louis-Thuillier"], "81":["Lycée Lapérouse"], "83":["Lycée Dumont d'Urville","Lycée Rouvière", "Lycée privé Saint-Joseph"], "84":["Lycée privé Saint-Joseph","Lycée Philippe-de-Girard","Lycée Frédéric Mistral"], "85":["Lycée privé Saint-Joseph","Lycée Pierre-Mendès-France"], "86":["Lycée Camille Guérin","Lycée Louis Armand"], "87":["Lycée Gay-Lussac","Lycée Turgot"], "88":["Lycée Claude Gellée"], "89":["Lycée Jacques Amyot"], "90":["Lycée Condorcet","Lycées Raoul Follereau"], "91":["Lycée Parc de Vilgénis","Lycée du Parc des Loges","Lycée Blaise-Pascal","Lycée Jean-Baptiste-Corot"], "92":["Lycée privé Sainte-Marie d'Antony","Lycée Newton-ENREA","Lycée Michelet","Lycée Louis-Pasteur","Lycée Lakanal","Lycée Passy-Buzenval"], "93":["Lycée Jean Jaurès","Lycée Albert Schweitzer", "Lycée Paul Eluard", "Lycée Le Corbusier"], "94":["Lycée Marcelin-Berthelot","Lycée d'Arsonval","Lycée Gustave-Eiffel"], "95":["Lycée Camille Pissarro","Lycée Jean-Perrin","Lycée Gustave-Monod"]};

            $("#input-zipcode").keyup(function() {
                if($(this).val().length ==4){zip = $(this).val().substring(0,1);}
                else{zip = $(this).val().substring(0,2);}
                    $("#select-nomprepa").empty();
                    if(prepas[zip]){
                        $("#select-nomprepa").removeAttr('disabled');
                        for(var i =0; i<prepas[zip].length; i++){
                            $("#select-nomprepa").append('<i class="icon-chevron-down"></i><option value="' + cleanURL(prepas[zip][i]) + '">' + prepas[zip][i] + '</option>')
                        }
                    }
                    else{
                        $("#select-nomprepa").attr("disabled", "disabled");
                        $("#select-nomprepa").append('<option>Pas de prépas trouvées pour ce code postal</option>')
                    }
            });


        $('form').submit(function(e) {
            e.preventDefault();
          
            if($('#input-mail')[0].checkValidity()){

                if($('#select-nomprepa').val()!="Pas de prépas trouvées pour ce code postal" && $('#select-nomprepa').val()!="Nom de la Prépa" && $('#input-zipcode').val() && $("input[name='filiere']:checked").val()){
                         var mailOK     = $('#input-mail').val();
                         var nomprepaOK = $('#select-nomprepa').val();
                         var zipcodeOK  = $('#input-zipcode').val();
                         var filiereOK  = $('input[name="filiere"]:checked').val();
                
                window.localStorage.setItem('db-updated',1);
                window.localStorage.setItem('mail', mailOK);
                window.localStorage.setItem('nomprepa', nomprepaOK);
                window.localStorage.setItem('zipcode', zipcodeOK);
                window.localStorage.setItem('filiere', filiereOK);
                         

                    refreshDB();


               }


                 else{
                     if($('#select-nomprepa').val()=="Pas de prépas trouvées pour ce code postal" || $('#select-nomprepa').val()=="Nom de la Prépa"){$('#select-nomprepa').addClass('invalid')};
                     if(!$('#input-zipcode').val()){$('#input-zipcode').addClass('invalid')};
                     if(!$("input[@name='filiere']:checked").val()){$("input[name='filiere']").addClass('invalid-radio')}

                 }
             }
            else{
                $('#input-mail').addClass('invalid');
        }

        })


        </script>
    </body>

</html>